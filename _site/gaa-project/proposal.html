<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tang Xin Yi">
<meta name="author" content="Jackson Tan Jun Sheng">
<meta name="author" content="Teo Ying Shi">

<title>IS415 Group 10 - Project Proposal</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">IS415 Group 10</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Overview</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../gaa-project/proposal.html" rel="" target="" aria-current="page">
 <span class="menu-text">Project Proposal</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../gaa-project/poster.html" rel="" target="">
 <span class="menu-text">Poster</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../gaa-project/user-guide.html" rel="" target="">
 <span class="menu-text">User Guide</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/tangxy0321/gga-ThaiRoad" rel="" target=""><i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Project Proposal</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Tang Xin Yi </p>
             <p>Jackson Tan Jun Sheng </p>
             <p>Teo Ying Shi </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="abstract" class="level2">
<h2 class="anchored" data-anchor-id="abstract"><strong>1. Abstract</strong></h2>
<p>This project involves conducting Spatial Point Patterns Analysis on road accidents in Thailand. We will be analysing the Thailand road accident data. In this project, a hotspot is defined to be a location/part of the road network that has more road accidents happening.</p>
<p>The goal of this project is to create a web application that aims to aid users in performing exploratory data analysis, kernel density estimation, first-order spatial point pattern analysis, second-order spatial point pattern analysis, spatiotemporal area analysis and network-constrained spatial points pattern analysis.</p>
<p>The user, assuming to have little or no coding experience, will be able to carry out the above stated analysis without the need for coding and in-depth knowledge about the dataset. This allows usage of geospatial data for relevant studies or other purposes.</p>
</section>
<section id="problem-motivation" class="level2">
<h2 class="anchored" data-anchor-id="problem-motivation"><strong>2. Problem &amp; Motivation</strong></h2>
<p>According to the 2018 Global Status Report on Road Safety by the World Health Organization (WHO), Thailand’s road traffic death rate was estimated at 32.7 deaths per 100,000 population. However, the serial report in 2023 indicated a reduction in the death rate related to road traffic to 23.7 deaths per 100,000 population. Despite this improvement, Thailand’s road traffic death rate remains significantly higher than that of Singapore. This great contrast in road safety between Thailand and Singapore has motivated our team to conduct a geospatial analysis on road accidents in Thailand.</p>
<p>Though by using the Internet, anyone would be able to download, manipulate and analyse the same dataset to obtain valuable insights and patterns that cannot be detected through human eyes. Yet this method is not as suitable for individuals with little to no coding experience.</p>
</section>
<section id="project-objectives" class="level2">
<h2 class="anchored" data-anchor-id="project-objectives"><strong>3. Project Objectives</strong></h2>
<p>The team would be creating an application using shiny that allows the user to do the following:</p>
<ol type="1">
<li><p>Exploratory data analysis to gain rough idea of the context of data</p></li>
<li><p>1st Order Kernel Density Estimation</p>
<ol type="a">
<li><p>Network-constrained Kernel Density Estimation (NKDE)</p></li>
<li><p>Temporal Network Kernel Density Estimation (TNKDE)</p></li>
</ol></li>
<li><p>2nd Order Kernel Density Estimation</p>
<ol type="a">
<li><p>Use appropriate functions from F, G, K, and L for spatial cluster analysis</p></li>
<li><p>Conduct a complete spatial randomness test, then a Monte Carlo test, to investigate correlation between spatial factor and road accident occurrence</p></li>
</ol></li>
</ol>
</section>
<section id="relevant-work" class="level2">
<h2 class="anchored" data-anchor-id="relevant-work"><strong>4. Relevant Work</strong></h2>
<section id="signal-ang-et-al.-n.d." class="level3">
<h3 class="anchored" data-anchor-id="signal-ang-et-al.-n.d."><strong>4.1. Signal (<a href="https://wiki.smu.edu.sg/1819t2is415/Signal_Research_Paper">Ang et al., n.d.</a>)</strong></h3>
<p>This project was done by our seniors with the aim to discover the network-constrained spatio-temporal patterns of traffic accidents Leeds, United Kingdom. The following four main analyses were explored in their project:</p>
<ul>
<li><p>Network Constrained Kernel Density Estimation (KDE)</p>
<ul>
<li>To visualise and identify the road segments with higher intensity of traffic accidents</li>
</ul></li>
<li><p>Network Constrained K- Function</p>
<ul>
<li>To determine if there is spatial correlation between accident points (i.e.&nbsp;dispersed, clustered or randomly distributed)</li>
</ul></li>
<li><p>Network Constrained Cross K-Function:</p>
<ul>
<li>To determine if there is spatial correlation between accident points and variables selected using multi-type K-function</li>
</ul></li>
<li><p>Network Constrained Cross Pair Correlation Function</p>
<ul>
<li>To determine if there is spatial correlation between accident points and variables selected using pair correlation function</li>
</ul></li>
</ul>
</section>
<section id="detecting-traffic-accident-clusters-with-network-kernel-density-estimation-and-local-spatial-statistics-an-integrated-approach-xie-yan-2013" class="level3">
<h3 class="anchored" data-anchor-id="detecting-traffic-accident-clusters-with-network-kernel-density-estimation-and-local-spatial-statistics-an-integrated-approach-xie-yan-2013"><strong>4.2. Detecting traffic accident clusters with network kernel density estimation and local spatial statistics: an integrated approach (<a href="https://doi.org/10.1016/j.jtrangeo.2013.05.009">Xie &amp; Yan, 2013</a>)</strong></h3>
<p>This study highlights the limitations in analysing traffic accidents through conventional Kernel Density Estimation (KDE) within a&nbsp; two-dimensional space as accidents are often constrained to network spaces. As such, the authors proposed the use of Network Constrained KDE (NetKDE) as a more suitable approach. However, both approaches lack formal spatial statistical methods in determining the statistical significance of accident hotspots. In order to address these limitations, the authors proposed to integrate network KDE with local Moran’s I for hotspot detection so as to leverage the strengths of each approach.</p>
</section>
</section>
<section id="data-source" class="level2">
<h2 class="anchored" data-anchor-id="data-source"><strong>5. Data Source</strong></h2>
<p>In this project, we will be using the following datasets:</p>
<table class="table">
<colgroup>
<col style="width: 71%">
<col style="width: 17%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th>Data</th>
<th>Type</th>
<th>Format</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Thailand Road Accident [2019-2022]</td>
<td>Aspatial</td>
<td>.csv</td>
</tr>
<tr class="even">
<td>Thailand Subnational Administrative Boundaries</td>
<td>Geospatial</td>
<td>.shp</td>
</tr>
<tr class="odd">
<td>Geofabrik’s OpenStreetMap road data for Thailand</td>
<td>Geospatial</td>
<td>.shp</td>
</tr>
</tbody>
</table>
<section id="thailand-road-accident-2019-2022" class="level3">
<h3 class="anchored" data-anchor-id="thailand-road-accident-2019-2022"><strong>5.1. Thailand Road Accident [2019-2022]</strong></h3>
<p>The <strong>Thailand Road Accident</strong> dataset, available in csv format, provides comprehensive records of traffic road accidents in Thailand, spanning from 2019 to 2022. It encompasses a wide range of information, including the dates, times, locations, weather conditions and road types. The data source is available <a href="https://www.kaggle.com/datasets/thaweewatboy/thailand-road-accident-2019-2022/data">here</a>.</p>
</section>
<section id="thailand---subnational-administrative-boundaries" class="level3">
<h3 class="anchored" data-anchor-id="thailand---subnational-administrative-boundaries"><strong>5.2. Thailand - Subnational Administrative Boundaries</strong></h3>
<p>The <strong>Thailand Subnational Administrative Boundaries</strong> dataset is available in ESRI shapefile format. It comprises the administrative boundaries at various levels within Thailand, including levels 0 (country), 1 (province), 2 (district), and 3 (sub-district or tambon).&nbsp; We will use this dataset to extract the boundary of Thailand. The data source is available <a href="https://data.humdata.org/dataset/cod-ab-tha">here</a>.</p>
</section>
<section id="openstreetmap-road-data-for-thailand" class="level3">
<h3 class="anchored" data-anchor-id="openstreetmap-road-data-for-thailand"><strong>5.3. OpenStreetMap road data for Thailand</strong></h3>
<p>The <strong>Geofabrik’s OpenStreetMap road data</strong> can be sourced from Geofabrik Download Server and is available in ESRI shape file format. It contains various layers such as roads, buildings and points of interest. We will be using this dataset to map out the road networks in Thailand. The data source is available <a href="https://download.geofabrik.de/asia/thailand.html">here</a>.</p>
</section>
</section>
<section id="methodology" class="level2">
<h2 class="anchored" data-anchor-id="methodology"><strong>6. Methodology</strong></h2>
<section id="data-preparation" class="level3">
<h3 class="anchored" data-anchor-id="data-preparation"><strong>6.1. Data Preparation</strong></h3>
<p>We will be performing data wrangling on the 3 datasets mentioned above so that we can perform our analyses, with the steps that we will take as follow:</p>
<section id="thailand-administrative-boundary-data" class="level4">
<h4 class="anchored" data-anchor-id="thailand-administrative-boundary-data"><strong>6.1.1. Thailand Administrative Boundary Data</strong></h4>
<ul>
<li><p>Extracting boundary of the whole of Thailand</p></li>
<li><p>Extracting geographical boundaries of all the provinces</p></li>
</ul>
</section>
<section id="thailand-road-accidents-dataset" class="level4">
<h4 class="anchored" data-anchor-id="thailand-road-accidents-dataset"><strong>6.1.2. Thailand Road Accidents Dataset</strong></h4>
<ul>
<li><p>Simplifying variables like cause of accidents and vehicle types into bigger subsets of categories.</p></li>
<li><p>Simplifying variables like number of fatalities and weather conditions into a boolean value (True/False, Yes/No).</p></li>
<li><p>Extracting key information like hour, month, or specific day of the week from the datetime variable of the accident into separate variables for temporal-related analysis.</p></li>
<li><p>Removing unnecessary data points that lie outside of Thailand by filtering it with the Thailand boundary data from above.</p></li>
<li><p>Dropping irrelevant fields like reporting datetime, agency, route name, and fields that are in Thai.</p></li>
</ul>
</section>
<section id="osm-thailand-roads-dataset" class="level4">
<h4 class="anchored" data-anchor-id="osm-thailand-roads-dataset"><strong>6.1.3. OSM Thailand Roads Dataset</strong></h4>
</section>
</section>
<section id="exploratory-data-analysis" class="level3">
<h3 class="anchored" data-anchor-id="exploratory-data-analysis"><strong>6.2. Exploratory Data Analysis</strong></h3>
<p>In this section, we will be performing the following EDA:</p>
<ul>
<li><p>Finding out the basic distribution of traffic accidents, categorised by the different factors.</p></li>
<li><p>Logistic Regression to find out the significance of each variable in determining whether an accident causes fatality.</p></li>
<li><p>Discover region specific info, like which reason has the highest accident rate, fatality rate etc.</p></li>
</ul>
</section>
<section id="overview-of-main-analyses" class="level3">
<h3 class="anchored" data-anchor-id="overview-of-main-analyses"><strong>6.3. Overview of Main Analyses</strong></h3>
<p>The main focus of our project would be on <strong><em>Spatial Point and Network-Constrained Spatial Point Analysis.</em></strong> Here are the analyses and techniques that we will be employing:</p>
<section id="exploratory-data-analysis-1" class="level4">
<h4 class="anchored" data-anchor-id="exploratory-data-analysis-1"><strong>6.3.1. Exploratory Data Analysis</strong></h4>
<p>We aim to uncover insights into the severity and outcome of accidents, exploring whether certain areas or times exhibit a higher likelihood of fatal incidents. This in-depth analysis will not only enhance our understanding of the overall road safety landscape but will also provide crucial information for developing targeted strategies to mitigate the severity of accidents, ultimately contributing to a comprehensive approach to improving traffic safety in Thailand.</p>
</section>
<section id="st-order-kernel-density-estimation" class="level4">
<h4 class="anchored" data-anchor-id="st-order-kernel-density-estimation"><strong>6.3.2. 1st Order Kernel Density Estimation</strong></h4>
<p>In this segment, we will use 1st Order Kernel Density Estimation methods to further refine our understanding of traffic accidents in Thailand. These statistical techniques go beyond identifying hotspots by providing a nuanced analysis of the intensity and spatial distribution of accidents. The 1st Order Kernel Density Estimation will offer a smoothed representation of the overall accident density.</p>
<p>By employing spatial point analysis on the traffic accidents in Thailand, we can explore the geographical distribution of accident hotspots and identify areas with higher risk.</p>
<p><strong>Network-constrained Kernel Density Estimation (NKDE)</strong></p>
<p>We will also explore the network-constrained spatial point analysis to gather insights into how the city’s road network contributes to accident occurrences, allowing for targeted interventions in critical areas.</p>
<p><strong>Temporal Network Kernel Density Estimation (TNKDE)</strong></p>
<p>In addition to that, we will explore whether festive periods contribute to the occurrence of traffic accidents. By examining temporal patterns and correlating them with festive events, we seek to provide a comprehensive understanding of the factors influencing road safety during celebratory periods.</p>
</section>
<section id="nd-order-kernel-density-estimation" class="level4">
<h4 class="anchored" data-anchor-id="nd-order-kernel-density-estimation"><strong>6.3.3. 2nd Order Kernel Density Estimation</strong></h4>
<p>In this segment, we will use 2nd Order Kernel Density Estimation methods instead to further refine our understanding of traffic accidents in Thailand. The 2nd Order Kernel Density Estimation will allow us to capture variations and fine-tune our identification of high-risk zones.</p>
<p><strong>G/F/K/L Function</strong></p>
<p><strong>Complete spatial randomness test</strong></p>
</section>
<section id="interactive-dashboards-using-shiny" class="level4">
<h4 class="anchored" data-anchor-id="interactive-dashboards-using-shiny"><strong>6.3.4. Interactive dashboards using Shiny</strong></h4>
<p>As we hope that the findings from this study can ultimately enhance road safety in Thailand, we will be creating interactive dashboards to empower urban planners, policymakers, and traffic authorities to explore comprehensive analyses, including accident hotspots, temporal patterns, network influences, and key metrics, facilitating informed decision-making in doing so.</p>
</section>
</section>
</section>
<section id="storyboard" class="level2">
<h2 class="anchored" data-anchor-id="storyboard"><strong>7. Storyboard</strong></h2>
</section>
<section id="timeline" class="level2">
<h2 class="anchored" data-anchor-id="timeline"><strong>8. Timeline</strong></h2>
<p><img src="img/Project-timeline.png" class="img-fluid"></p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references"><strong>9. References</strong></h2>
<p>Ang, J. Y., Chong, S., &amp; Tan, Y. L. (2019, April 15). Signal Research Paper. SMU Wikipedia. https://wiki.smu.edu.sg/1819t2is415/Signal_Research_Paper</p>
<p>Safety and Mobility (SAM) &amp; Social Determinants of Health (SDH). (2023, December 13). <em>Global status report on road safety 2023</em>. World Health Organization. https://www.who.int/publications/i/item/9789240086517</p>
<p>Social Determinants of Health (SDH). (2018, June 17). <em>Global status report on road safety 2018</em>. World Health Organization. https://www.who.int/publications/i/item/9789241565684</p>
<p>Xie, Z., &amp; Yan, J. J. (2013). Detecting traffic accident clusters with network kernel density estimation and local spatial statistics: an integrated approach. <em>Journal of Transport Geography</em>, <em>31</em>, 64–71. https://doi.org/10.1016/j.jtrangeo.2013.05.009</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>